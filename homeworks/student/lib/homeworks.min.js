var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,f){if(f.get||f.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[e]=f.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var e=0;return $jscomp.iteratorPrototype(function(){return e<a.length?{done:!1,value:a[e++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var e=a[Symbol.iterator];return e?e.call(a):$jscomp.arrayIterator(a)};
$jscomp.polyfill=function(a,e,f,b){if(e){f=$jscomp.global;a=a.split(".");for(b=0;b<a.length-1;b++){var h=a[b];h in f||(f[h]={});f=f[h]}a=a[a.length-1];b=f[a];e=e(b);e!=b&&null!=e&&$jscomp.defineProperty(f,a,{configurable:!0,writable:!0,value:e})}};$jscomp.EXPOSE_ASYNC_EXECUTOR=!0;$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function e(){this.batch_=null}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;e.prototype.asyncExecute=function(c){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(c);return this};e.prototype.asyncExecuteBatch_=function(){var c=this;this.asyncExecuteFunction(function(){c.executeBatch_()})};var f=$jscomp.global.setTimeout;e.prototype.asyncExecuteFunction=function(c){f(c,0)};e.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var c=
this.batch_;this.batch_=[];for(var a=0;a<c.length;++a){var b=c[a];delete c[a];try{b()}catch(u){this.asyncThrow_(u)}}}this.batch_=null};e.prototype.asyncThrow_=function(c){this.asyncExecuteFunction(function(){throw c;})};var b=function(c){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var a=this.createResolveAndReject_();try{c(a.resolve,a.reject)}catch(k){a.reject(k)}};b.prototype.createResolveAndReject_=function(){function c(c){return function(e){b||(b=!0,c.call(a,e))}}var a=this,b=
!1;return{resolve:c(this.resolveTo_),reject:c(this.reject_)}};b.prototype.resolveTo_=function(c){if(c===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(c instanceof b)this.settleSameAsPromise_(c);else{var a;a:switch(typeof c){case "object":a=null!=c;break a;case "function":a=!0;break a;default:a=!1}a?this.resolveToNonPromiseObj_(c):this.fulfill_(c)}};b.prototype.resolveToNonPromiseObj_=function(c){var a=void 0;try{a=c.then}catch(k){this.reject_(k);return}"function"==
typeof a?this.settleSameAsThenable_(a,c):this.fulfill_(c)};b.prototype.reject_=function(a){this.settle_(2,a)};b.prototype.fulfill_=function(a){this.settle_(1,a)};b.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};b.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),
a[b]=null;this.onSettledCallbacks_=null}};var h=new e;b.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};b.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(u){c.reject(u)}};b.prototype.then=function(a,e){function c(a,b){return"function"==typeof a?function(b){try{f(a(b))}catch(A){h(A)}}:b}var f,h,l=new b(function(a,b){f=a;h=b});this.callWhenSettled_(c(a,f),
c(e,h));return l};b.prototype["catch"]=function(a){return this.then(void 0,a)};b.prototype.callWhenSettled_=function(a,b){function c(){switch(e.state_){case 1:a(e.result_);break;case 2:b(e.result_);break;default:throw Error("Unexpected state: "+e.state_);}}var e=this;null==this.onSettledCallbacks_?h.asyncExecute(c):this.onSettledCallbacks_.push(function(){h.asyncExecute(c)})};b.resolve=function(a){return a instanceof b?a:new b(function(b,c){b(a)})};b.reject=function(a){return new b(function(b,c){c(a)})};
b.race=function(a){return new b(function(c,e){for(var f=$jscomp.makeIterator(a),h=f.next();!h.done;h=f.next())b.resolve(h.value).callWhenSettled_(c,e)})};b.all=function(a){var c=$jscomp.makeIterator(a),e=c.next();return e.done?b.resolve([]):new b(function(a,f){function h(b){return function(c){k[b]=c;l--;0==l&&a(k)}}var k=[],l=0;do k.push(void 0),l++,b.resolve(e.value).callWhenSettled_(h(k.length-1),f),e=c.next();while(!e.done)})};$jscomp.EXPOSE_ASYNC_EXECUTOR&&(b.$jscomp$new$AsyncExecutor=function(){return new e});
return b},"es6-impl","es3");$jscomp.checkStringArgs=function(a,e,f){if(null==a)throw new TypeError("The 'this' value for String.prototype."+f+" must not be null or undefined");if(e instanceof RegExp)throw new TypeError("First argument to String.prototype."+f+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,f){var b=$jscomp.checkStringArgs(this,a,"startsWith");a+="";for(var e=b.length,c=a.length,l=Math.max(0,Math.min(f|0,b.length)),k=0;k<c&&l<e;)if(b[l++]!=a[k++])return!1;return k>=c}},"es6-impl","es3");
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(a,f){var b=$jscomp.checkStringArgs(this,a,"endsWith");a+="";void 0===f&&(f=b.length);for(var e=Math.max(0,Math.min(f|0,b.length)),c=a.length;0<c&&0<e;)if(b[--e]!=a[--c])return!1;return 0>=c}},"es6-impl","es3");var Homeworks={};
(function(){function a(d){g.online?console.log(d.target.src):Homeworks.wsinit()}function e(){g.connect?g.student?g.online?l():Homeworks.wsinit():Homeworks.getStudentId().then(function(d){return Homeworks.wsinit()})["catch"](function(d){return alert(d)}):(g.connect=!0,Homeworks.getStudentId().then(function(d){return Homeworks.wsinit()})["catch"](function(d){return alert(d)}))}function f(d){switch(d.key){case "R":v("RESTART",{rc:0});break;case "S":v("STATE",{});break;case "Q":3<H++&&v("RESTART",{rc:-1});
break;default:H=0}}function b(d,a){d?I=!0:(n=0,I&&setTimeout(h,5E3));g.online=d;Homeworks.updateState()}function h(){location.reload(!1)}function c(d){d=JSON.parse(d);w&&console.log("REC",d);if(g.id!==d.from)switch(d.id){case "ID":g.id=d.data.id;g.server.match(/localhost|127.0.0.1/)&&(g.server=d.data.ip);v("JOIN",{student:g.student,page:location.pathname});break;case "STORE":0<n&&(n--,0>d.data.rc?(alert("\ud83d\udeab Hausaufgabe von "+d.data.name+" NICHT erfolgreich abgegeben: "+d.data.msg),n=0):
0==n&&(x&&(clearTimeout(x),x=null),alert("\ud83c\udf40 Hausaufgabe von "+d.data.name+" erfolgreich abgegeben.")));break;case "STATE":w||console.log("REC",d)}}function l(){var d=document.getElementById("homework");if(null!=d){var a=(new URL(d.src)).pathname.replace(/.*\//,"");a.match(/[0-9]/)[0]==Homeworks.aufgabe?0==n?(n=2,x=setTimeout(k,1E4),u(d)):alert("\ud83d\ude44Vorherige 'Abgeben' Funktion ist noch aktiv.\n\u26a0\ufe0f Bitte noch etwas warten."):alert("\ud83d\udeab Der Name der Javascript Datei '"+
a+"' passt nicht zur Aufgabennummer in dieser Datei:\nHomeworks.aufgabe = "+Homeworks.aufgabe+".\n\u26a0\ufe0f Bitte entweder den Dateinamen oder die Aufgabennummer anpassen.")}else alert("\ud83d\udeab Die Hausaufgabe ist in der HTML Seite nicht mit der id 'homework' markiert:\n<script ... id=\"homework\">.\n\u26a0\ufe0f Bitte diese id einf\u00fcgen.")}function k(){0<n&&(alert("\ud83d\udeab Hausaufgabe NICHT abgegeben: Keine R\u00fcckmeldung vom Server erhalten.\n\u26a0\ufe0f Nochmals probieren und wenn es weiterhin nicht geht, bitte melden."),
n=0,x=null)}function u(a){B(a.src,"text/javascript").then(function(d){return E(d,{file:(new URL(a.src)).pathname})});B(location.origin+location.pathname,"text/html").then(function(a){return E(a,{file:location.pathname})})}function E(a,b){b.file.endsWith("html")&&(a=a.replace(/\x3c!-- Code injected by live-server --\x3e(.|\n)+<\/script>\n*/m,""));v("STORE",{file:b.file.replace(/\/homeworks\/student/,""),student:g.student,page:location.pathname.replace(/\/homeworks\/student/,""),aufgabe:Homeworks.aufgabe,
code:C.encode(a)})}function B(a,b){return new Promise(function(d,y){A({type:"GET",url:a,responseType:"text",headers:{"Content-Type":b},success:function(a,b){return d(a)},error:function(a,d){return y(a)}})})}function J(a,b,c){try{var d=new WebSocket(a,"echo-protocol");d.onopen=function(a){b(!0,d)};d.onclose=function(a){b(!1,null)};d.onping=function(a){b(!1,null)};d.onerror=function(a){b(!1,null);console.log("ERR",a)};d.onmessage=function(a){c(a.data)};d.calcLag=function(a,b){if(a.from===d.user.ID){t[L++%
5]=(b-a.ts)/2;var y=0;if(4<t.length){for(var c=t.slice().sort()[2],e=0,p=0;p<t.length;p++)1E3>Math.abs(t[p]-c)&&(y+=t[p],e++);console.log("lag",y/e)}}};return d}catch(K){return console.log(K),null}}function F(a){a+="=";for(var d=document.cookie.split(";"),b=0;b<d.length;b++){var c=d[b].trim();if(0===c.indexOf(a))return c.substring(a.length,c.length)}return null}function G(a,b,c){b=document.createElementNS(a.namespaceURI,b);a.appendChild(b);for(attr in c)b.setAttribute(attr,c[attr]);return b}function A(a){var b=
M();b.onreadystatechange=function(){if(4===b.readyState)if(200===b.status||0===b.status&&b.response){if(a.context){var d=b.getResponseHeader("xxx");"undefined"!==d&&(a.context.xxx=d)}switch(a.responseType){case "arraybuffer":case "blob":a.success(b.response,a.context);break;case "document":a.success(b.responseXML,a.context);break;case "json":a.success(b.response,a.context);break;case "":case "text":a.success(b.responseText,a.context);break;default:a.success(b.responseText,a.context)}}else a.error(b,
b.getAllResponseHeaders())};a.responseType&&(b.responseType=a.responseType);b.open(a.type,a.url,!0);if(a.headers)for(header in a.headers)b.setRequestHeader(header,a.headers[header]);a.xxx&&b.setRequestHeader("xxx",a.xxx);a.data?b.send(a.data):b.send()}function M(){if(window.XMLHttpRequest)return new XMLHttpRequest;var a=new ActiveXObject("Microsoft.XMLHTTP");a.overrideMimeType("text/plain; charset=utf-8");return a}var w=!1,z,q,t=[],L=0,g={student:null,name:null,id:null,connect:!1,online:!1,server:null},
m,r,I=!1,x=null,n=0,H=0;this.gc=g;this.aufgabe=0;this.updateState=function(){location.hostname.match(/localhost|127.0.0.1/)?Homeworks.showStatus():Homeworks.showReview()};this.createReviewNode=function(){m=document.getElementById("status");null==m&&(m=G(document.body,"div",{id:"status",style:"position: absolute; top:10px;right:30px;"}));Homeworks.showReview();window.addEventListener("keydown",f)};this.showReview=function(){if(null!=m){r&&r.removeEventListener("click",e);var b=new URL(window.location);
g.student=b.searchParams.get("id");g.name=b.searchParams.get("name");b=document.getElementById("homework");null!=b&&(new URL(b.src)).pathname.replace(/.*\//,"");m.innerHTML=g.name+(g.online?' <span style="font-size: 2em;"> <span id="review" style="cursor: pointer"><img src="img/g.png"> <img src="img/y.png"> <img src="img/r.png"></span> <a href="'+b.src+'">\ud83d\udd2c</a></span>':' <span id="review" style="cursor: pointer;font-size: 2em;">\ud83d\udd34</span>');(r=document.getElementById("review"))&&
r.addEventListener("click",a)}};this.getStudentId=function(){return new Promise(function(a,b){B("data/student.id","text/html").then(function(b){g.student=b.replace(/[\r\n].*/,"");a(!0)},function(a){Homeworks.showStatus();b('\u26a0\ufe0f Datei "data/student.id" konnte nicht geladen werden: ('+a.statusText+" "+a.status+').\nDamit die Hausaufgaben per Knopfdruck abgegeben werden k\u00f6nnen, bitte gleich das \u26a0\ufe0f oben rechts anklicken.\nAnmelden mit "ig1" / "Fun2Code".')})})};this.createStatusNode=
function(){m=document.getElementById("status");null==m&&(m=G(document.body,"div",{id:"status",style:"position: absolute; top:10px;right:30px;"}));Homeworks.showStatus();location.pathname.match(/\/homeworks\/student/)&&window.addEventListener("keydown",f)};this.showStatus=function(){null!=m&&(r&&r.removeEventListener("click",e),m.innerHTML=g.connect?g.student?g.online?'<span id="send" style="cursor: pointer;font-size: 2em;">\ud83d\udce4</span>':'<span id="send" style="cursor: pointer;font-size: 2em;">\ud83d\udd34</span>':
'Datei "data/student.id" fehlt <a href="https://byron.hopto.org:11204/studentIds.html" target="_blank">\u26a0\ufe0f</a>':'<span id="send" style="cursor: pointer;font-size: 2em;">\ud83d\udd17</span>',(r=document.getElementById("send"))&&r.addEventListener("click",e))};this.wsinit=function(){var a=new URL(window.location.href);q=a.searchParams.get("name");if(null==q)q=F("name"),null==q&&(q="Studi"+Math.floor(100+899*Math.random()));else if(q.startsWith("Studi")){var e=F("name");null!=e&&(q=e)}else if(e=
q,null==e)document.cookie="name=; expires=Thu, 01 Jan 1970 00:00:00 UTC";else{var p=new Date;p.setTime(p.getTime()+7776E6);document.cookie="name="+e+"; expires="+p.toUTCString()+"; path=/"}a.searchParams.get("port");w=w||null!=a.searchParams.get("trace");a=a.searchParams.get("server");g.server=a?a:"byron.hopto.org";z=J("wss://"+g.server+":11204",b,c);return g};for(var v=function(a,b){if(z&&z.readyState===WebSocket.OPEN){var d={id:a,from:g.id,ts:(new Date).getTime(),data:b};w&&console.log("SND",d);
z.send(JSON.stringify(d));"RESTART"==d.id&&0==d.data.rc&&setTimeout(h,2E3)}},D=0;256>D;D++)D.toString(16);var C={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b="",d,c,e,f,g,h,k=0;for(a=C._utf8_encode(a);k<a.length;)d=a.charCodeAt(k++),c=a.charCodeAt(k++),e=a.charCodeAt(k++),f=d>>2,d=(d&3)<<4|c>>4,g=(c&15)<<2|e>>6,h=e&63,isNaN(c)?g=h=64:isNaN(e)&&(h=64),b=b+this._keyStr.charAt(f)+this._keyStr.charAt(d)+this._keyStr.charAt(g)+this._keyStr.charAt(h);
return b},decode:function(a){var b="",c,d,e,f,g,h=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");h<a.length;)c=this._keyStr.indexOf(a.charAt(h++)),d=this._keyStr.indexOf(a.charAt(h++)),f=this._keyStr.indexOf(a.charAt(h++)),g=this._keyStr.indexOf(a.charAt(h++)),c=c<<2|d>>4,d=(d&15)<<4|f>>2,e=(f&3)<<6|g,b+=String.fromCharCode(c),64!=f&&(b+=String.fromCharCode(d)),64!=g&&(b+=String.fromCharCode(e));return b=C._utf8_decode(b)},_utf8_encode:function(a){var b="";a=a.replace(/\r\n/g,"\n");for(var c=0;c<a.length;c++){var d=
a.charCodeAt(c);128>d?b+=String.fromCharCode(d):(127<d&&2048>d?b+=String.fromCharCode(d>>6|192):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128)),b+=String.fromCharCode(d&63|128))}return b},_utf8_decode:function(a){for(var b="",c=0,d,e,f;c<a.length;)d=a.charCodeAt(c),128>d?(b+=String.fromCharCode(d),c++):191<d&&224>d?(e=a.charCodeAt(c+1),b+=String.fromCharCode((d&31)<<6|e&63),c+=2):(e=a.charCodeAt(c+1),f=a.charCodeAt(c+2),b+=String.fromCharCode((d&15)<<12|(e&63)<<6|f&63),c+=
3);return b}}}).apply(Homeworks);document.addEventListener("DOMContentLoaded",function(){location.hostname.match(/localhost|127.0.0.1/)?Homeworks.createStatusNode():Homeworks.createReviewNode()});
